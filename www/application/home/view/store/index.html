<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title>线下场景宝-商户</title>
    <link rel="stylesheet" type="text/css" href="/static/home/icon-custom/iconfont.css">
    <link rel="stylesheet" href="/static/home/css/frozen.css">
    <link rel="stylesheet" href="/static/home/css/index.css">
    <link rel="stylesheet" href="/static/home/css/store.css">
    <link rel="stylesheet" href="/static/home/css/dialog-plugin.css">
</head>
<body ontouchstart="">
<section id="banner" class="ui-placehold-img">
    <span style="background:url(/static/home/img/banner2b.jpg) no-repeat center/cover;"></span>
</section>
<section class="ui-container">
    <section id="tab">
        <div class="demo-item">
            <div class="demo-block">
                <div class="ui-tab">
                    <ul class="ui-tab-nav ui-border-b">
                        <li class="current">待验证</li>
                        <li>验证记录</li>
                    </ul>
                    <ul class="ui-tab-content" style="width:300%">
                        <li>
                            {foreach $list as $v}
                            <div class="ui-row-flex ui-whitespace">
                                <div class="ui-col ui-col-3 code">{$v.code_str}</div>
                                <a class="ui-col button" href="javascript:void(0);" onclick="validate(this,{$v.id})">确定验证</a>
                            </div>
                            {/foreach}

                        </li>
                        <li>
                            <div class="ui-row-flex ui-whitespace">
                                <div class="ui-col detail left">
                                    <p class="detail-code">验证码: CC85A26</p>
                                    <p>折扣类型：满100元减25元</p>
                                </div>
                                <div class="ui-col detail right">
                                    <p>消费总金额：236.00元</p>
                                    <p>2018-01-29  17:23:40</p>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>
    <section class="total">共有:{$count}条验证记录</section>
    <section class="page">
        <a class="up disable">上一页</a>
        <a class="down disable">下一页</a>
    </section>
</section>
<script src="/static/home/lib/zepto.min.js"></script>
<script src="/static/home/js/frozen.js"></script>
<script src="/static/home/js/dialog-plugin.js"></script>
<script>
    (function (){
        var tab = new fz.Scroll('.ui-tab', {
            role: 'tab',
            autoplay: false,
            interval: 3000
        });
        /* 滑动开始前 */
        tab.on('beforeScrollStart', function(fromIndex, toIndex) {
            console.log(fromIndex,toIndex);// from 为当前页，to 为下一页
        })
    })();
    //验证
    function validate( curren , id ){
      var $btn = $(curren);
      if($btn.hasClass('disable')){return false;}
      var infoDialog = $.dialog({
        type : 'info',
        infoText : '加载中…',
        infoIcon : '/static/home/img/loading.gif'
      });
      $.ajax({
        url: '/home/store/validate_code',
        type: 'post',
        dataType:'json',
        data:{ 'id':id },
        success: function (response) {
          if( response.code && response.code == 1 ){
            infoDialog.dialog.update({
              autoClose : 1500,
              infoText : response.msg,
              infoIcon : '/static/home/img/success.png'
            });

          }else {
            infoDialog.dialog.update({
              autoClose : 1500,
              infoText : response.msg,
              infoIcon : '/static/home/img/fail.png'
            });
          }
        },
        error: function () {
          infoDialog.dialog.update({
            autoClose : 1500,
            infoText : '发生错误!',
            infoIcon : '/static/home/img/fail.png'
          });
        }
      });
    }
</script>
</body>
</html>